{
    "name": "CA_scene",
    "title": "Cellular Automata Explorer",
    "images": 
    [ 
        { 
            "type": "uimage", 
            "filename": "nebula_files/crab_nebula.jpg", 
            "name": "nebula"
        },
        { 
            "type": "uimage", 
            "filename": "nebula_files/hk_square_512.jpg", 
            "name": "nebula_mask"
        }
    ],
    "elements":
    [
        {
            "name": "nebula_element",
            "image": "nebula",
            "mask": "nebula_mask",
            "scale": 0.3
        }
    ],
    "functions":
    [
        {
            "name": "brush_fn",
            "type": "position_gen_fn",
            "position": { "functions": [ "mouse_position" ] }
        },
        {
            "name": "direction_4",
            "type": "direction_picker_4",
            "default_value": "down",
            "label": "Direction",
            "description": "Direction of gravity"
        },
        {
            "name": "direction_8",
            "type": "direction_picker_8",
            "default_value": "down",
            "label": "Direction",
            "description": "Direction of sort"
        },
        {
            "name": "edge_block_switch",
            "type": "switch_fn",
            "label": "Edge block",
            "description": "Freezes pixels on the edge of the image",
            "tool": "switch",
            "default_value": true
        },
        {
            "name": "bright_block_slider",
            "type": "range_slider_int",
            "label": "Brightness freeze",
            "description": "Freezes pixels with brighness outside the range",
            "min": 0,
            "max": 768,
            "default_value": [ 10, 768 ],
            "step": 1
        },
        {
            "name": "bright_block_switch",
            "type": "switch_fn",
            "label": "Brightness block",
            "description": "Freezes pixels with brighness outside the range",
            "tool": "switch",
            "default_value": false
        },
        {
            "name": "bright_block_widget_switch",
            "type": "widget_switch",
            "label": "Brightness freeze",
            "description": "Freeze pixels with brighness outside the range",
            "switcher": "bright_block_switch",
            "widget": "bright_block_slider"
        },
        {
            "name": "max_diff_slider",
            "type": "slider_int",
            "label": "Sort Threshold",
            "description": "Sort Threshold is the maximum brightness difference between adjacent pixels that will be sorted.",
            "min": 0,
            "max": 768,
            "default_value": 230,
            "step": 1
        },        
        {
            "name": "life_slider",
            "type": "slider_int",
            "label": "Brightness Threshold",
            "description": "Pixels with brighness above threshold become alive.",
            "min": 0,
            "max": 768,
            "default_value": 384,
            "step": 1
        },
        {
            "name": "rule_menu",
            "type": "menu_int",
            "tool": "pull_down",
            "label": "Transition Rule",
            "description": "Transition rules include cellular automata such as Conway's Game of Life, and other ways each frame can depend on the previous one.",
            "items": [ "Diffuse", "Life", "Gravitate", "Snow", "Pixel sort", "Funky sort" ],
            "default_choice": 5
        },
        {
            "name": "rule_menu_0",
            "type": "equal_int_condition",
            "a": { "functions": [ "rule_menu" ] },
            "b": 0
        },
        {
            "name": "rule_menu_1",
            "type": "equal_int_condition",
            "a": { "functions": [ "rule_menu" ] },
            "b": 1
        },
        {
            "name": "rule_menu_2",
            "type": "equal_int_condition",
            "a": { "functions": [ "rule_menu" ] },
            "b": 2
        },
        {
            "name": "rule_menu_3",
            "type": "equal_int_condition",
            "a": { "functions": [ "rule_menu" ] },
            "b": 3
        },
        {
            "name": "rule_menu_4",
            "type": "equal_int_condition",
            "a": { "functions": [ "rule_menu" ] },
            "b": 4
        },
        {
            "name": "rule_menu_5",
            "type": "equal_int_condition",
            "a": { "functions": [ "rule_menu" ] },
            "b": 5
        },
        {
            "name": "funk_factor_menu",
            "type": "menu_string",
            "tool": "pull_down",
            "label": "Funk Factor",
            "description": "Funk factor is a parameter of the Funky sort rule.",
            "choices": [ "Borg", "Funky Town", "Web" ],
            "default_choice": 0
        }
    ],
    "clusters":
    [
        {
            "name": "brush_cluster",
            "element": "nebula_element",
            "functions": [ "brush_fn" ],
            "conditions": [ "mouse_click" ]
        }
    ],
    "effects":
    [
        {
            "name": "gray",
            "type": "eff_grayscale_ucolor"
        },
        {
            "name": "mirror",
            "type": "eff_mirror_ucolor",
            "reflect_x": true,
            "reflect_y": true
        },
        {
            "name": "turn_right",
            "type": "eff_turn_ucolor",
            "direction": "up"
        },
        {
            "name": "Diffuse",
            "type": "CA_ucolor",
            "edge_block": { "functions": [ "edge_block_switch" ] },
            "rule":
            {
                "name": "diffuse",
                "type": "rule_diffuse_ucolor"            
            }
        },        
        {
            "name": "Life",
            "type": "CA_ucolor",
            "edge_block": { "functions": [ "edge_block_switch" ] },
            "rule":
            {
                "name": "life",
                "type": "rule_life_ucolor"            
            }
        },
        {
            "name": "Gravitate",
            "type": "CA_ucolor",
            "edge_block": { "functions": [ "edge_block_switch" ] },
            "rule":
            {
                "name": "gravitate",
                "type": "rule_gravitate_ucolor",
                "direction": { "functions": [ "direction_4" ] }
            }
        },
        {
            "name": "Snow",
            "type": "CA_ucolor",
            "edge_block": { "functions": [ "edge_block_switch" ] },
            "rule":
            {
                "name": "snow",
                "type": "rule_snow_ucolor",
                "direction": { "functions": [ "direction_4" ] }
            }
        },
        {
            "name": "Pixel sort",
            "type": "CA_ucolor",
            "edge_block": {"functions": [ "edge_block_switch" ] },
            "bright_block": { "functions": [ "bright_block_switch" ] },
            "bright_range": { "functions": [ "bright_block_slider" ] },
            "rule":
            {
                "name": "pixel_sort",
                "type": "rule_pixel_sort_ucolor",
                "direction": { "functions": [ "direction_8" ] },
                "max_diff": { "functions": [ "max_diff_slider" ] }
            }
        },
        {
            "name": "Funky sort",
            "type": "CA_ucolor",
            "edge_block": {"functions": [ "edge_block_switch" ] },
            "bright_block": { "functions": [ "bright_block_switch" ] },
            "bright_range": { "functions": [ "bright_block_slider" ] },
            "rule":
            {
                "name": "funky_sort",
                "type": "rule_funky_sort_ucolor",
                "direction": { "functions": [ "direction_8" ] },
                "dafunk_d": "0xffffffffaa00aa00",
                "dafunk_l": "0x5fc1850e6d728137",
                "dafunk_r": "0xfa6c916dae77c405",
                "max_diff": { "functions": [ "max_diff_slider" ] }
            }
        },
        {
            "name": "Rule Chooser",
            "type": "eff_chooser",
            "effects": [ "Diffuse", "Life", "Gravitate", "Snow", "Pixel sort", "Funky sort" ],
            "choice": { "functions": [ "rule_menu" ] }
        },
        {
            "name": "brush",
            "type": "cluster",
            "cluster_name": "brush_cluster"
        }
    ],
    "queue":
    [
        {
            "name": "nebula_mask",
            "source": "nebula",
            "type": "uimage",
            "mode": "static",  
            "effects": [ "gray" ]
        },
        {
            "name": "nebula_mirror",
            "source": "nebula",
            "type": "uimage",
            "mode": "static",  
            "effects": [ "turn_right" ]
        },
        {
            "name": "nebula_sort",
            "source": "nebula_mirror",
            "type": "uimage",
            "mode": "iterative",  
            "effects": [ "brush", "Rule Chooser" ]
        }
    ],
    "widget groups":
    [
        {
            "name": "home_group",
            "widgets": [ "rule_menu", "edge_block_switch" ]
        },
        {
            "name": "diffuse_group",
            "conditions": [ "rule_menu_0" ],
            "widgets": [ "max_diff_slider" ]
        },
        {
            "name": "life_group",
            "conditions": [ "rule_menu_1" ],
            "widgets": [ "life_slider" ]
        },
        {
            "name": "gravitate_group",
            "conditions": [ "rule_menu_2" ],
            "widgets": [ "direction_4" ]
        },
        {
            "name": "snow_group",
            "conditions": [ "rule_menu_3" ],
            "widgets": [ "direction_4" ]
        },
        {
            "name": "pixel_sort_group",
            "conditions": [ "rule_menu_4" ],
            "widgets": [ "direction_8", "max_diff_slider", "bright_block_widget_switch" ]
        },
        {
            "name": "funky_sort_group",
            "conditions": [ "rule_menu_5" ],
            "widgets": [ "direction_8", "max_diff_slider", "bright_block_widget_switch", "funk_factor_menu" ]
        }
    ]
}
